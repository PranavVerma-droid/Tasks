{% extends "base.html" %}

{% block title %}Home - Notion Alternative{% endblock %}

{% block breadcrumb %}
<span>Home</span>
{% endblock %}

{% block top_bar_actions %}
<button class="btn btn-primary" onclick="createNewRootPage()">
    <i class="fas fa-plus"></i>
    New Page
</button>
{% endblock %}

{% block content %}
<div class="welcome-section">
    <div class="welcome-header">
        <h1>Welcome to Your Workspace</h1>
        <p>Create pages, databases, and organize your tasks with powerful repetition features.</p>
    </div>
    
    <div class="quick-actions">
        <div class="action-card" onclick="createNewRootPage()">
            <div class="action-icon">
                <i class="fas fa-file-alt"></i>
            </div>
            <h3>New Page</h3>
            <p>Create a new page to organize your content</p>
        </div>
        
        <div class="action-card" onclick="location.href='{{ url_for('calendar_view') }}'">
            <div class="action-icon">
                <i class="fas fa-calendar-alt"></i>
            </div>
            <h3>Calendar View</h3>
            <p>View all your tasks in a calendar layout</p>
        </div>

        <div class="action-card" onclick="location.href='{{ url_for('notes_view') }}'">
            <div class="action-icon">
                <i class="fas fa-clipboard"></i>
            </div>
            <h3>Notes View</h3>
            <p>Manage your personal notes and ideas</p>
        </div>
    </div>
    
    <div class="recent-pages">
        <h2>Recent Pages</h2>
        <div class="pages-grid">
            {% for page_id, page in data.pages.items() %}
            <div class="page-card" onclick="location.href='{{ url_for('view_page', page_id=page_id) }}'">
                <div class="page-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="page-info">
                    <h3>{{ page.title }}</h3>
                    <p>Last updated: {{ page.updated_at.split('T')[0] if page.updated_at else 'Never' }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script type="text/javascript">
// Assign page IDs from Jinja to a JS variable
const allPageIds = {{ data.pages.keys() | list | tojson | safe }};

/**
 * Creates a new root page and redirects to it.
 * Makes a POST request to the /api/create_page endpoint.
 */
function createNewRootPage() {
    fetch('/api/create_page', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title: 'Untitled Page', properties: {} })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success && data.page_id) {
            window.location.href = `/page/${data.page_id}`;
        } else {
            // Using a more modern notification would be better than alert.
            console.error('Failed to create new page.');
        }
    })
    .catch(error => {
        console.error('Error creating new page:', error);
    });
}
// Ensure the function is available in the global scope for the onclick attributes.
window.createNewRootPage = createNewRootPage;

/**
 * Navigates to the first available page.
 * This is a placeholder function.
 */
function createNewPage() {
    // For now, redirect to the first page
    if (allPageIds.length > 0) {
        window.location.href = `/page/${allPageIds[0]}`;
    }
}

/**
 * Navigates to the first available page to create a database there.
 * This is a placeholder function.
 */
function createDatabase() {
    // For now, redirect to the first page to create database there
    if (allPageIds.length > 0) {
        window.location.href = `/page/${allPageIds[0]}`;
    }
}

/**
 * Placeholder function for adding a page to a database.
 * @param {string} databaseId - The ID of the database.
 */
function addPageToDatabase(databaseId) {
    console.log('Add Page to Database is not implemented on the home page. Please use this feature inside a page or database.');
}
</script>
{% endblock %}
