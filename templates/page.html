{% extends "base.html" %}

{% block title %}{{ page.title }} - Notion Alternative{% endblock %}

{% block breadcrumb %}
<a href="{{ url_for('index') }}">Home</a>
{% if hierarchy %}
{% for item in hierarchy %}
<span class="breadcrumb-separator">/</span>
{% if item.type == 'page' %}
<a href="{{ url_for('navigate_to_page', page_id=item.id) }}">{{ item.title }}</a>
{% else %}
<a href="{{ url_for('navigate_to_database', database_id=item.id) }}">{{ item.title }}</a>
{% endif %}
{% endfor %}
{% else %}
<span class="breadcrumb-separator">/</span>
<span>{{ page.title }}</span>
{% endif %}
{% endblock %}

{% block top_bar_actions %}
<button class="btn btn-secondary" onclick="addDatabase()">
    <i class="fas fa-database"></i>
    Add Database
</button>
{% endblock %}

{% block content %}
<div class="page-container">
    <div class="page-header">
        <div class="page-title-container">
            <h1 class="page-title" id="pageTitle" contenteditable="true">{{ page.title }}</h1>
        </div>
        <div class="page-actions">
            <button class="btn btn-secondary" onclick="window.history.back()">
                <i class="fas fa-arrow-left"></i> Back
            </button>
        </div>
    </div>
    
    <div class="page-content">
        <!-- Editable Page Description Section -->
        <div id="pageDescriptionContainer">
            <div class="description-toggle-container">
                <div class="description-toggle-header" onclick="toggleDescription('pageDescriptionContainer')">
                    <i class="fas fa-chevron-down toggle-icon"></i>
                    <span class="toggle-text">Description</span>
                    <span class="toggle-indicator">
                        {% if 'description' in page.properties and page.properties.description.rich_text_content|default('', true)|length > 0 %}
                            Has content
                        {% else %}
                            Empty
                        {% endif %}
                    </span>
                </div>
                <div class="description-content expanded" id="pageDescriptionContainer_content">
                    <textarea id="pageDescriptionContainer_editor" data-rich-text="true" data-placeholder="Enter a detailed description...">{% if 'description' in page.properties %}{{ page.properties.description.rich_text_content|safe }}{% else %}{% endif %}</textarea>
                </div>
            </div>
        </div>
        
        <!-- Existing databases -->
        {% for database in databases %}
        <div class="database-container" data-database-id="{{ database.id }}">
            <div class="database-header">
                <h3 class="database-title">{{ database.name }}</h3>
                <div class="database-actions">
                    <button class="btn btn-sm btn-secondary" onclick="addPageToDatabase('{{ database.id }}')">
                        <i class="fas fa-plus"></i>
                        Add Page
                    </button>
                    <button class="btn btn-sm btn-secondary" onclick="editDatabase('{{ database.id }}')">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
            <div class="database-table">
                <div class="database-table-header">
                    <!-- Header is now rendered by JS -->
                </div>
                <div class="database-table-body" id="databaseBody_{{ database.id }}">
                    <!-- Table body rendered by JS -->
                </div>
            </div>
        </div>
        {% endfor %}
        
        <!-- Empty state -->
        {% if not databases %}
        <div class="empty-state">
            <div class="empty-state-icon">
                <i class="fas fa-database"></i>
            </div>
            <h3>No databases yet</h3>
            <p>Create your first database to start organizing your content.</p>
            <button class="btn btn-primary" onclick="addDatabase()">
                <i class="fas fa-plus"></i>
                Create Database
            </button>
        </div>
        {% endif %}
    </div>
</div>

<style>
.date-time-inputs {
    display: flex;
    gap: 8px;
    align-items: center;
}
.date-time-inputs .form-control {
    flex-grow: 1;
}
.database-table-header {
    display: grid;
    /* grid-template-columns will be set by JS */
    gap: 10px;
    padding: 12px 15px;
    background-color: #2a2a2a;
    font-weight: 600;
    border-bottom: 1px solid #444;
}
.database-table-row {
    display: grid;
    /* grid-template-columns must match the header */
    gap: 10px;
    padding: 12px 15px;
    border-bottom: 1px solid #333;
    align-items: center;
}
.database-table-row:hover {
    background-color: #2c2c2c;
}
</style>

{% endblock %}

{% block extra_js %}
<script>
    // Set global page ID for app.js to use.
    // This script runs before app.js because of how base.html is structured.
    window.currentPageId = '{{ page.id }}';
</script>
{% endblock %}
